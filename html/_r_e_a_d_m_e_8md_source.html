<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Caiman: README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Caiman_logo_FIsmall.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Caiman
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">A Computational toolbox for large scale Calcium Imaging Analysis</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_r_e_a_d_m_e_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_r_e_a_d_m_e_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;CaImAn</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;======</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&lt;img src=&quot;https://github.com/simonsfoundation/CaImAn/blob/master/docs/LOGOS/Caiman_logo_FI.png&quot; width=&quot;500&quot; align=&quot;right&quot;&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;[![Join the chat at https://gitter.im/agiovann/SOURCE_EXTRACTION_PYTHON](https://badges.gitter.im/agiovann/SOURCE_EXTRACTION_PYTHON.svg)](https://gitter.im/agiovann/SOURCE_EXTRACTION_PYTHON?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;a href=&#39;https://travis-ci.org/simonsfoundation/CaImAn&#39;&gt;&lt;img src=&#39;https://secure.travis-ci.org/simonsfoundation/CaImAn.png?branch=master&#39;&gt;&lt;/a&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;A Computational toolbox for large scale **Ca**lcium **Im**aging **An**alysis*</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;Recent advances in calcium imaging acquisition techniques are creating datasets of the order of Terabytes/week. Memory and computationally efficient algorithms are required to analyze in reasonable amount of time terabytes of data. This projects implements a set of essential methods required in the calcium imaging movies analysis pipeline. Fast and scalable algorithms are implemented for motion correction, movie manipulation and source and spike extraction.</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;### Features</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;* Handling of very large datasets</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    * Memory mapping</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    * Frame-by-frame online processing  (some functions)</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    * opencv-based efficient movie playing and resizing</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;* Motion correction</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    * Fast parallelizable open-cv and fft-based motion correction of large movies</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    * Run also in online mode (i.e. one frame at a time)</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    * non rigid motion correction</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;* Source extraction </div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    * identification of pixles associated to each neuron/neuronal structure</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    * deals with heavily overlaping and neuroopil contaminated movies </div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    * separates different sources based on Nonnegative Matrix Factorization algorithms</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;* Denoising, deconvolution and spike extraction</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    * spikes can be inferred from fluorescence traces</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    * also works in online mode (i.e. one sample at a time)</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;### Installation</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;* Installation on Mac </div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;   * Download and install Anaconda (Python 2.7 or Python 3.5) &lt;http://docs.continuum.io/anaconda/install&gt;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;   ```bash</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;   </div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;   git clone https://github.com/simonsfoundation/CaImAn</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;   cd CaImAn/</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;   git pull</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;   </div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   EITHER</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   conda create -n CaImAn python=3.5 --file requirements_conda.txt   (For Python 3)</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;   OR</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;   conda create -n CaImAn ipython --file requirements_conda.txt   (For Python 2) </div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;   </div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;   source activate CaImAn</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   pip install -r requirements_pip.txt</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;   conda install -c menpo opencv3=3.1.0</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;   python setup.py build_ext -i</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;   conda install bokeh</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;   ```</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;* Installation on Linux </div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;   * Download and install Anaconda (Python 2.7 or Python 3.5) &lt;http://docs.continuum.io/anaconda/install&gt;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;   ```bash</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;   </div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;   git clone https://github.com/simonsfoundation/CaImAn</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;   cd CaImAn/</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;   git pull</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;   conda create -n CaImAn ipython --file requirements_conda.txt    </div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;   source activate CaImAn</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;   pip install -r requirements_pip.txt</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;   conda install -c menpo opencv3=3.2.0</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;   python setup.py build_ext -i</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;   conda install bokeh</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;   ```</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;   * To make the package available from everywhere and have it working *efficiently* under any configuration ALWAYS run these lines before starting spyder:</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;   ```bash</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;   export PYTHONPATH=&quot;/path/to/caiman:$PYTHONPATH&quot;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;   export MKL_NUM_THREADS=1</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;   export OPENBLAS_NUM_THREADS=1</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;   ```</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;* Installation on posix (Windows)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;   * Download and install Anaconda (Python 2.7) &lt;http://docs.continuum.io/anaconda/install&gt;, GIT (&lt;https://git-scm.com/&gt;) and Microsoft Visual C++ Compiler for Python 2.7 &lt;https://www.microsoft.com/en-us/download/details.aspx?id=44266&gt;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    ```bash</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    </div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    git clone  https://github.com/simonsfoundation/CaImAn</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    cd CaImAn</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    git pull</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    conda update conda</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    conda create -n CaImAn ipython --file requirements_conda.txt    </div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    activate CaImAn</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    pip install -r requirements_pip.txt</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    conda install -c menpo opencv3=3.1.0</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    python setup.py build_ext -i</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    conda update --all</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    </div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    ```</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;# Example</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  ### Demos</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;* Notebooks : The notebooks provide a simple and friendly way to get into CaImAn and understand its main characteristics. </div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;   * you can find them in directly in CaImAn and launch them from your ipython Notebook application:</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;   </div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   * to launch jupyter notebook :</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;   </div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;       ```bash</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    </div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        source activate CaImAn</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        conda launch jupyter</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    </div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;       ```</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;   </div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  * /!\ if you want to launch directly the python files, please be advised that your python console still needs to be in the CaImAn folder and not somewhere else. </div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;# Testing</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;* As of today, all of the commits needs to be previously tested before asking for a pull request. Call &#39;nosetests&#39; program from inside of your CaImAn folder to look for defects. </div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  ### general_test</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;   * This test will run the entire CaImAn program and look for differences against the original one. If your changes have made significant differences able to be recognise by this test. You are left with two choices : </div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;   </div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;       * Either it is a desired on purpose changement of the code. You will then need to submit your pull request. Adding to it the generated folder in tests/comparison/tests that you will need to rename &#39;tosend&#39;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    </div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;       * Else it is an unplanned difference that has been found by the tests. In this situation, happy debugging. </div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;   </div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;   </div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;# Contributors:</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;* Giovannucci, Andrea. **Simons Foundation** </div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;* Pnevmatikakis, Eftychios. **Simons Foundation** </div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;* Friedrich, Johannes. **Columbia University and Janelia Farm**</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;* Cobos, Erick. **Baylor College of Medicine**</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;* Staneva, Valentina. **eScience Institute**</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;* Deverett, Ben. **Princeton University**</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;* Kalfon, Jérémie. **University of Kent** , **ECE paris** </div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;Please refer to the following wiki [page](https://github.com/simonsfoundation/CaImAn/wiki/Processing-large-datasets) or read in the testing section below.</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;# Deconvolution and demixing of calcium imaging data</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;The code implements simultaneous source extraction and spike inference from large scale calcium imaging movies. The code is suitable for the analysis of somatic imaging data. Implementation for the analysis of dendritic/axonal imaging data will be added in the near future. The following references provide the theoretical background and original code for the included methods. </div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;Pnevmatikakis, E.A., Soudry, D., Gao, Y., Machado, T., Merel, J., ... &amp; Paninski, L. (2016). Simultaneous denoising, deconvolution, and demixing of calcium imaging data. Neuron 89(2):285-299, http://dx.doi.org/10.1016/j.neuron.2015.11.037. [Github repo](https://github.com/epnev/ca_source_extraction). </div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;Pnevmatikakis, E.A., Gao, Y., Soudry, D., Pfau, D., Lacefield, C., ... &amp; Paninski, L. (2014). A structured matrix factorization framework for large scale calcium imaging data analysis. arXiv preprint arXiv:1409.2903. http://arxiv.org/abs/1409.2903. </div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;Friedrich J. and Paninski L. Fast active set methods for online spike inference from calcium imaging. NIPS, 29:1984-1992, 2016. [PDF](https://papers.nips.cc/paper/6505-fast-active-set-methods-for-online-spike-inference-from-calcium-imaging). [Github repository](https://github.com/j-friedrich/OASIS).</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;Code description and related packages</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;=======</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;The implementation of this package is developed in parallel with a MATLAB toobox, which can be found [here](https://github.com/epnev/ca_source_extraction). </div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;Some tools that are currently available in Matlab and not in Python are at the following links</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;- [MCMC spike inference](https://github.com/epnev/continuous_time_ca_sampler) </div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;- [Group LASSO initialization and spatial CNMF](https://github.com/danielso/ROI_detect)</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;Troubleshooting</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;----------------</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;**Python 3 and spyder**</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;if spyder crashes on mac os run </div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;```</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;brew install --upgrade openssl</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;brew unlink openssl &amp;&amp; brew link openssl --force</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;```</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;**SCS**:</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;if you get errors compiling scs when installing cvxpy you probably need to create a link to openblas or libgfortran in</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;/usr/local/lib/, for instance:</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;`sudo ln -s  /Library/Frameworks/R.framework/Libraries/libgfortran.3.dylib  /usr/local/lib/libgfortran.2.dylib`</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;**debian fortran compiler problems:**</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;if you get the error  gcc: error trying to exec &#39;cc1plus&#39;: execvp: No such file or directory in ubuntu run</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;or issues related to SCS type</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; ```</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; sudo apt-get install g++ libatlas-base-dev gfortran  libopenblas-dev</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; conda install openblas atlas</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; ```</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; if still there are issues try</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  `export LD_LIBRARY_PATH=/path_to_your_home/anaconda2/lib/`</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; if more problems try </div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; ```</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; conda install  atlas (only Ubuntu)</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; pip install &#39;tifffile&gt;=0.7&#39;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; conda install accelerate</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; conda install openblas </div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; ```</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;**CVXOPT**:</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;If you are on Windows and don&#39;t manage to install or compile cvxopt, a simple solution is to download the right binary [there](http://www.lfd.uci.edu/~gohlke/pythonlibs/#cvxopt) and install the library by typing:</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;```</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;pip install cvxopt-1.1.7-XXXX.whl</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;```</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;Test the system</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;----------------</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;**SINGLE PATCH**</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;In case you used installation af point 1 above you will need to download the test files from</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;&lt;https://github.com/agiovann/Constrained_NMF/releases/download/v0.3/Demo.zip&gt;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;A. Go into the cloned folder, type `python demo.py`</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;B. Using the Spyder (type `conda install spyder`) IDE.</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    1. Unzip the file Demo.zip (you do not need this step if you installed dusing method 2 above, just enter the Constrained_NMF folder and you will find all the required files there).</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    2. Open the file demo.py with spyder</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    3. change the base_folder variable to point to the folder you just unzipped</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    3. Run the cells one by one inspecting the output</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    4. Remember to stop the cluster (last three lines of file). You can also stop it manually by typing in a terminal</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    &#39;ipcluster stop&#39;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;C. Using notebook.</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    1. Unzip the file Demo.zip (you do not need this step if you installed dusing method 3 above, just enter the Constrained_NMF folder and you will find all the required files there).</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    2. type `ipython notebook`</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    3. open the notebook called demoCNMF.ipynb </div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    4. change the base_folder variable to point to the folder you just unzipped</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    5. and run cell by cell inspecting the result</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    6. Remember to stop the cluster (last three lines of file). You can also stop it manually by typing in a terminal</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    &#39;ipcluster stop&#39;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;**MULTI PATCH**</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;+ Download the two demo movies [here](https://github.com/agiovann/Constrained_NMF/releases/download/v0.4-alpha/Patch_demo.zip) (courtesy of Dr. Sue Ann Koay from the Tank Lab, Princeton Neuroscience Institute, Princeton. NJ). Unzip the folder. Then in Spyder open the file demo_patches.py, and change the base_folder variable to point to the folder you just unzipped. </div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;+ Run one by one the cells (delimited by &#39;#%%&#39;) </div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;+ Inspect the results. The demo will start a cluster and process pathes of the movie (more details [here](https://github.com/agiovann/Constrained_NMF/wiki/Processing-large-datasets)) in parallel (cse.map_reduce.run_CNMF_patches). Afterwards, it will merge the results back together and proceed to firstly merge potentially overlaping components (cse.merge_components) from different patches, secondly to update the spatial extent of the joined spatial components (cse.spatial.update_spatial_components), and finally denoising the traces (cse.temporal.update_temporal_components). THe final bit is used for visualization. </div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;Documentation</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;========</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;Documentation of the code can be found [here](http://agiovann.github.io/Constrained_NMF)</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;Dependencies</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;========</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;The code uses the following libraries</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;- [NumPy](http://www.numpy.org/)</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;- [SciPy](http://www.scipy.org/)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;- [Matplotlib](http://matplotlib.org/)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;- [Scikit-Learn](http://scikit-learn.org/stable/)</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;- [Tifffile](https://pypi.python.org/pypi/tifffile) For reading tiff files. Other choices can work there too.</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;- [cvxpy](http://www.cvxpy.org/) for solving optimization problems</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;- [ipyparallel](http://ipyparallel.readthedocs.org/en/latest/) for parallel processing</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;- [opencv](http://opencv.org/) for efficient image manipulation and visualization</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;External Dependencies</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;============</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;For the constrained deconvolution method (```deconvolution.constrained_foopsi```)  various solvers can be used, each of which requires some additional packages:</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;1. ```&#39;cvxpy&#39;```: (default) For this option, the following packages are needed:</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  * [CVXOPT](http://cvxopt.org/) Required.</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  * [CVXPY](http://www.cvxpy.org/) Required.</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;2. ```&#39;cvx&#39;```: For this option, the following packages are needed:</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  * [CVXOPT](http://cvxopt.org/) Required.</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  * [PICOS](http://picos.zib.de/) Required.</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;In general ```&#39;cvxpy&#39;``` can be faster, when using the &#39;ECOS&#39; or &#39;SCS&#39; sovlers, which are included with the CVXPY installation.</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;Questions, comments, issues</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;=======</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;Please use the gitter chat room (use the button above) for questions and comments and create an issue for any bugs you might encounter.</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;License</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;=======</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;This program is free software; you can redistribute it and/or</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;modify it under the terms of the GNU General Public License</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;as published by the Free Software Foundation; either version 2</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;of the License, or (at your option) any later version.</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;This program is distributed in the hope that it will be useful,</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;but WITHOUT ANY WARRANTY; without even the implied warranty of</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;GNU General Public License for more details.</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;You should have received a copy of the GNU General Public License</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;```</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="footer" role="contentinfo">
&copy; Copyright 2015, Eftychios Pnevmatikakis and Andrea Giovannucci.Created using 
<a href="http://www.stack.nl/~dimitri/doxygen/">Doxygen</a> </div>