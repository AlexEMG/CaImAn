<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Caiman: caiman.motion_correction Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Caiman_logo_FIsmall.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Caiman
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">A Computational toolbox for large scale Calcium Imaging Analysis</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('namespacecaiman_1_1motion__correction.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">caiman.motion_correction Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcaiman_1_1motion__correction_1_1_motion_correct.html">MotionCorrect</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">class implementing motion correction operations  <a href="classcaiman_1_1motion__correction_1_1_motion_correct.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a54e0e94e8c54dadcad8bc6688e46c590"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#a54e0e94e8c54dadcad8bc6688e46c590">apply_shift_iteration</a> (img, shift, border_nan=False, border_type=cv2.BORDER_REFLECT)</td></tr>
<tr class="separator:a54e0e94e8c54dadcad8bc6688e46c590"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af84483b6805cfea4c866952cd5fc801c"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#af84483b6805cfea4c866952cd5fc801c">apply_shift_online</a> (movie_iterable, xy_shifts, save_base_name=None, order='F')</td></tr>
<tr class="separator:af84483b6805cfea4c866952cd5fc801c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef9c5f795aeb47c5b86066492953fc4f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#aef9c5f795aeb47c5b86066492953fc4f">motion_correct_online_multifile</a> (list_files, add_to_movie, order='C', kwargs)</td></tr>
<tr class="separator:aef9c5f795aeb47c5b86066492953fc4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a178e8317ba3a15bd5e072132ce6fa9f3"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#a178e8317ba3a15bd5e072132ce6fa9f3">motion_correct_online</a> (movie_iterable, add_to_movie, max_shift_w=25, max_shift_h=25, save_base_name=None, order='C', init_frames_template=100, show_movie=False, bilateral_blur=False, template=None, min_count=1000, border_to_0=0, n_iter=1, remove_blanks=False, show_template=False, return_mov=False, use_median_as_template=False)</td></tr>
<tr class="separator:a178e8317ba3a15bd5e072132ce6fa9f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc77134c68d447075e79102eca9649e1"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#acc77134c68d447075e79102eca9649e1">motion_correct_iteration</a> (img, template, frame_num, max_shift_w=25, max_shift_h=25, bilateral_blur=False, diameter=10, sigmaColor=10000, sigmaSpace=0)</td></tr>
<tr class="separator:acc77134c68d447075e79102eca9649e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a089b96a369b9ee10a01d01e3df54c3bb"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#a089b96a369b9ee10a01d01e3df54c3bb">bin_median</a> (mat, window=10, exclude_nans=False)</td></tr>
<tr class="memdesc:a089b96a369b9ee10a01d01e3df54c3bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">compute median of 3D array in along axis o by binning values  <a href="#a089b96a369b9ee10a01d01e3df54c3bb">More...</a><br /></td></tr>
<tr class="separator:a089b96a369b9ee10a01d01e3df54c3bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac516b7c059d60b6dd4ba80de17f659bb"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#ac516b7c059d60b6dd4ba80de17f659bb">process_movie_parallel</a> (arg_in)</td></tr>
<tr class="memdesc:ac516b7c059d60b6dd4ba80de17f659bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">buffer_mean=np.zeros((bin_size,)+tf[0].shape).astype() template=np.mean(means_partials[:count_part],0)[ms_h:h_i-ms_h,ms_w:w_i-ms_w] if multicolor: buffer_mean[countbin_size]=page.asarray()[:,:,0]-to_remove else: buffer_mean[countbin_size]=page.asarray()-to_remove  <a href="#ac516b7c059d60b6dd4ba80de17f659bb">More...</a><br /></td></tr>
<tr class="separator:ac516b7c059d60b6dd4ba80de17f659bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d2c5818773d564a27f831175498ee9a"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#a7d2c5818773d564a27f831175498ee9a">motion_correct_parallel</a> (file_names, fr=10, template=None, margins_out=0, max_shift_w=5, max_shift_h=5, remove_blanks=False, apply_smooth=False, dview=None, save_hdf5=True)</td></tr>
<tr class="memdesc:a7d2c5818773d564a27f831175498ee9a"><td class="mdescLeft">&#160;</td><td class="mdescRight">motion correct many movies usingthe ipyparallel cluster  <a href="#a7d2c5818773d564a27f831175498ee9a">More...</a><br /></td></tr>
<tr class="separator:a7d2c5818773d564a27f831175498ee9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa339d12f180017a763175f450816f158"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#aa339d12f180017a763175f450816f158">_upsampled_dft</a> (data, upsampled_region_size, upsample_factor=1, axis_offsets=None)</td></tr>
<tr class="memdesc:aa339d12f180017a763175f450816f158"><td class="mdescLeft">&#160;</td><td class="mdescRight">adapted from SIMA (<a href="https://github.com/losonczylab">https://github.com/losonczylab</a>) and the scikit-image (<a href="http://scikit-image.org/">http://scikit-image.org/</a>) package.  <a href="#aa339d12f180017a763175f450816f158">More...</a><br /></td></tr>
<tr class="separator:aa339d12f180017a763175f450816f158"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09859fe5f2beba321b5397662b26651b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#a09859fe5f2beba321b5397662b26651b">_compute_phasediff</a> (cross_correlation_max)</td></tr>
<tr class="memdesc:a09859fe5f2beba321b5397662b26651b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute global phase difference between the two images (should be zero if images are non-negative).  <a href="#a09859fe5f2beba321b5397662b26651b">More...</a><br /></td></tr>
<tr class="separator:a09859fe5f2beba321b5397662b26651b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a683f5ee23e529946b17f6a87ae45e0a4"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#a683f5ee23e529946b17f6a87ae45e0a4">_compute_error</a> (cross_correlation_max, src_amp, target_amp)</td></tr>
<tr class="memdesc:a683f5ee23e529946b17f6a87ae45e0a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute RMS error metric between <code>src_image</code> and <code>target_image</code>.  <a href="#a683f5ee23e529946b17f6a87ae45e0a4">More...</a><br /></td></tr>
<tr class="separator:a683f5ee23e529946b17f6a87ae45e0a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0700d66a3a6b2556b1c712daf9c18a9b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#a0700d66a3a6b2556b1c712daf9c18a9b">register_translation</a> (src_image, target_image, upsample_factor=1, space=&quot;real&quot;, shifts_lb=None, shifts_ub=None, max_shifts=(10, 10))</td></tr>
<tr class="separator:a0700d66a3a6b2556b1c712daf9c18a9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4fabc7e2b2082da438e99a60ca41d96"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#ad4fabc7e2b2082da438e99a60ca41d96">apply_shifts_dft</a> (src_freq, shifts, diffphase, is_freq=True, border_nan=False)</td></tr>
<tr class="separator:ad4fabc7e2b2082da438e99a60ca41d96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef362667b31a29dfcc1a0c35c87f01ad"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#aef362667b31a29dfcc1a0c35c87f01ad">sliding_window</a> (image, overlaps, strides)</td></tr>
<tr class="memdesc:aef362667b31a29dfcc1a0c35c87f01ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">efficiently and lazily slides a window across the image  <a href="#aef362667b31a29dfcc1a0c35c87f01ad">More...</a><br /></td></tr>
<tr class="separator:aef362667b31a29dfcc1a0c35c87f01ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add17b575eb5d81897f4653cab5f2c8e5"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#add17b575eb5d81897f4653cab5f2c8e5">iqr</a> (a)</td></tr>
<tr class="separator:add17b575eb5d81897f4653cab5f2c8e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88ef513cfa324fc8548e4fb46d7a67e5"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#a88ef513cfa324fc8548e4fb46d7a67e5">create_weight_matrix_for_blending</a> (img, overlaps, strides)</td></tr>
<tr class="memdesc:a88ef513cfa324fc8548e4fb46d7a67e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">create a matrix that is used to normalize the intersection of the stiched patches  <a href="#a88ef513cfa324fc8548e4fb46d7a67e5">More...</a><br /></td></tr>
<tr class="separator:a88ef513cfa324fc8548e4fb46d7a67e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea060208c09f0e4fb01e6d31b9acf36f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#aea060208c09f0e4fb01e6d31b9acf36f">tile_and_correct</a> (img, template, strides, overlaps, max_shifts, newoverlaps=None, newstrides=None, upsample_factor_grid=4, upsample_factor_fft=10, show_movie=False, max_deviation_rigid=2, add_to_movie=0, shifts_opencv=False)</td></tr>
<tr class="memdesc:aea060208c09f0e4fb01e6d31b9acf36f"><td class="mdescLeft">&#160;</td><td class="mdescRight">perform piecewise rigid motion correction iteration, by 1) dividing the FOV in patches 2) motion correcting each patch separately 3) upsampling the motion correction vector field 4) stiching back together the corrected subpatches  <a href="#aea060208c09f0e4fb01e6d31b9acf36f">More...</a><br /></td></tr>
<tr class="separator:aea060208c09f0e4fb01e6d31b9acf36f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab468f81cbf77caf649a1aa60b21fecdd"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#ab468f81cbf77caf649a1aa60b21fecdd">compute_flow_single_frame</a> (frame, templ, pyr_scale=.5, levels=3, winsize=100, iterations=15, poly_n=5, poly_sigma=1.2/5, flags=0)</td></tr>
<tr class="separator:ab468f81cbf77caf649a1aa60b21fecdd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93dc0dbba76cd31384bb0fdca775fff6"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#a93dc0dbba76cd31384bb0fdca775fff6">compute_metrics_motion_correction</a> (fname, final_size_x, final_size_y, swap_dim, pyr_scale=.5, levels=3, winsize=100, iterations=15, poly_n=5, poly_sigma=1.2/5, flags=0, play_flow=False, resize_fact_flow=.2, template=None)</td></tr>
<tr class="separator:a93dc0dbba76cd31384bb0fdca775fff6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa13476234008dda16f62dc69804dab54"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#aa13476234008dda16f62dc69804dab54">motion_correct_batch_rigid</a> (fname, max_shifts, dview=None, splits=56, num_splits_to_process=None, num_iter=1, template=None, shifts_opencv=False, save_movie_rigid=False, add_to_movie=None, nonneg_movie=False)</td></tr>
<tr class="memdesc:aa13476234008dda16f62dc69804dab54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function that perform memory efficient hyper parallelized rigid motion corrections while also saving a memory mappable file.  <a href="#aa13476234008dda16f62dc69804dab54">More...</a><br /></td></tr>
<tr class="separator:aa13476234008dda16f62dc69804dab54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29956f4cd15f5c59388862472d370986"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#a29956f4cd15f5c59388862472d370986">motion_correct_batch_pwrigid</a> (fname, max_shifts, strides, overlaps, add_to_movie, newoverlaps=None, newstrides=None, dview=None, upsample_factor_grid=4, max_deviation_rigid=3, splits=56, num_splits_to_process=None, num_iter=1, template=None, shifts_opencv=False, save_movie=False, nonneg_movie=False)</td></tr>
<tr class="memdesc:a29956f4cd15f5c59388862472d370986"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function that perform memory efficient hyper parallelized rigid motion corrections while also saving a memory mappable file.  <a href="#a29956f4cd15f5c59388862472d370986">More...</a><br /></td></tr>
<tr class="separator:a29956f4cd15f5c59388862472d370986"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c4d6e518f42c395cb58a08d2ff21f45"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#a9c4d6e518f42c395cb58a08d2ff21f45">tile_and_correct_wrapper</a> (params)</td></tr>
<tr class="separator:a9c4d6e518f42c395cb58a08d2ff21f45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0609d5c64bb9cae41d945bbc89535d2a"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#a0609d5c64bb9cae41d945bbc89535d2a">motion_correction_piecewise</a> (fname, splits, strides, overlaps, add_to_movie=0, template=None, max_shifts=(12, 12), max_deviation_rigid=3, newoverlaps=None, newstrides=None, upsample_factor_grid=4, order='F', dview=None, save_movie=True, base_name=None, num_splits=None, shifts_opencv=False, nonneg_movie=False)</td></tr>
<tr class="separator:a0609d5c64bb9cae41d945bbc89535d2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab04c428554c372b6f5a453c673f56cc8"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecaiman_1_1motion__correction.html#ab04c428554c372b6f5a453c673f56cc8">opencv</a> = True</td></tr>
<tr class="separator:ab04c428554c372b6f5a453c673f56cc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a683f5ee23e529946b17f6a87ae45e0a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a683f5ee23e529946b17f6a87ae45e0a4">&#9670;&nbsp;</a></span>_compute_error()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction._compute_error </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>cross_correlation_max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>src_amp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>target_amp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compute RMS error metric between <code>src_image</code> and <code>target_image</code>. </p>
<h2>Parameters </h2>
<p>cross_correlation_max complex The complex value of the cross correlation at its maximum point.</p>
<p>src_amp float The normalized average image intensity of the source image</p>
<p>target_amp float The normalized average image intensity of the target image </p>

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01045">1045</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a683f5ee23e529946b17f6a87ae45e0a4_cgraph.svg" width="504" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a09859fe5f2beba321b5397662b26651b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09859fe5f2beba321b5397662b26651b">&#9670;&nbsp;</a></span>_compute_phasediff()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction._compute_phasediff </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>cross_correlation_max</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compute global phase difference between the two images (should be zero if images are non-negative). </p>
<h2>Parameters </h2>
<p>cross_correlation_max complex The complex value of the cross correlation at its maximum point. </p>

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01025">1025</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a09859fe5f2beba321b5397662b26651b_icgraph.svg" width="726" height="147"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aa339d12f180017a763175f450816f158"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa339d12f180017a763175f450816f158">&#9670;&nbsp;</a></span>_upsampled_dft()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction._upsampled_dft </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>upsampled_region_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>upsample_factor</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>axis_offsets</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>adapted from SIMA (<a href="https://github.com/losonczylab">https://github.com/losonczylab</a>) and the scikit-image (<a href="http://scikit-image.org/">http://scikit-image.org/</a>) package. </p>
<p>Unless otherwise specified by LICENSE.txt files in individual directories, all code is</p>
<p>Copyright (C) 2011, the scikit-image team All rights reserved.</p>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>
<ol type="1">
<li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>
<li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>
<li>Neither the name of skimage nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</li>
</ol>
<p>THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<p>Upsampled DFT by matrix multiplication.</p>
<p>This code is intended to provide the same result as if the following operations were performed:</p><ul>
<li>Embed the array "data" in an array that is <code>upsample_factor</code> times larger in each dimension. ifftshift to bring the center of the image to (1,1).</li>
<li>Take the FFT of the larger array.</li>
<li>Extract an <code>[upsampled_region_size]</code> region of the result, starting with the <code>[axis_offsets+1]</code> element.</li>
</ul>
<p>It achieves this result by computing the DFT in the output array without the need to zeropad. Much faster and memory efficient than the zero-padded FFT approach if <code>upsampled_region_size</code> is much smaller than <code>data.size * upsample_factor</code>.</p>
<h2>Parameters </h2>
<p>data 2D ndarray The input data array (DFT of original data) to upsample.</p>
<p>upsampled_region_size integer or tuple of integers, optional The size of the region to be sampled. If one integer is provided, it is duplicated up to the dimensionality of <code>data</code>.</p>
<p>upsample_factor integer, optional The upsampling factor. Defaults to 1.</p>
<p>axis_offsets tuple of integers, optional The offsets of the region to be sampled. Defaults to <a class="el" href="namespace_none.html" title="pipeline for showing the GUI function in CaImAn ">None</a> (uses image center)</p>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>output 2D ndarray The upsampled DFT of the specified region. </dd></dl>

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l00982">982</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_aa339d12f180017a763175f450816f158_icgraph.svg" width="768" height="198"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a54e0e94e8c54dadcad8bc6688e46c590"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54e0e94e8c54dadcad8bc6688e46c590">&#9670;&nbsp;</a></span>apply_shift_iteration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.apply_shift_iteration </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>img</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>border_nan</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>border_type</em> = <code>cv2.BORDER_REFLECT</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l00259">259</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a54e0e94e8c54dadcad8bc6688e46c590_icgraph.svg" width="598" height="168"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="af84483b6805cfea4c866952cd5fc801c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af84483b6805cfea4c866952cd5fc801c">&#9670;&nbsp;</a></span>apply_shift_online()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.apply_shift_online </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>movie_iterable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>xy_shifts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>save_base_name</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>order</em> = <code>'F'</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l00282">282</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_af84483b6805cfea4c866952cd5fc801c_cgraph.svg" width="331" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_af84483b6805cfea4c866952cd5fc801c_icgraph.svg" width="408" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ad4fabc7e2b2082da438e99a60ca41d96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4fabc7e2b2082da438e99a60ca41d96">&#9670;&nbsp;</a></span>apply_shifts_dft()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.apply_shifts_dft </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>src_freq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shifts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>diffphase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>is_freq</em> = <code>True</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>border_nan</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01315">1315</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_ad4fabc7e2b2082da438e99a60ca41d96_icgraph.svg" width="512" height="103"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a089b96a369b9ee10a01d01e3df54c3bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a089b96a369b9ee10a01d01e3df54c3bb">&#9670;&nbsp;</a></span>bin_median()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.bin_median </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>window</em> = <code>10</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>exclude_nans</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>compute median of 3D array in along axis o by binning values </p>
<h2>Parameters </h2>
<p>mat ndarray input 3D matrix, time along first dimension</p>
<p>window int number of frames in a bin</p>
<h2></h2>
<p>img: median image</p>
<h2>Raise </h2>
<p>Exception('Path to template does not exist:'+template) </p>

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l00564">564</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a089b96a369b9ee10a01d01e3df54c3bb_icgraph.svg" width="814" height="116"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ab468f81cbf77caf649a1aa60b21fecdd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab468f81cbf77caf649a1aa60b21fecdd">&#9670;&nbsp;</a></span>compute_flow_single_frame()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.compute_flow_single_frame </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>templ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>pyr_scale</em> = <code>.5</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>levels</em> = <code>3</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>winsize</em> = <code>100</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iterations</em> = <code>15</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>poly_n</em> = <code>5</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>poly_sigma</em> = <code>1.2/5</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>flags</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01606">1606</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_ab468f81cbf77caf649a1aa60b21fecdd_cgraph.svg" width="1019" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_ab468f81cbf77caf649a1aa60b21fecdd_icgraph.svg" width="544" height="103"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a93dc0dbba76cd31384bb0fdca775fff6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93dc0dbba76cd31384bb0fdca775fff6">&#9670;&nbsp;</a></span>compute_metrics_motion_correction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.compute_metrics_motion_correction </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>final_size_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>final_size_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>swap_dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>pyr_scale</em> = <code>.5</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>levels</em> = <code>3</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>winsize</em> = <code>100</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iterations</em> = <code>15</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>poly_n</em> = <code>5</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>poly_sigma</em> = <code>1.2/5</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>flags</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>play_flow</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>resize_fact_flow</em> = <code>.2</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>template</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01612">1612</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a93dc0dbba76cd31384bb0fdca775fff6_cgraph.svg" width="824" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a93dc0dbba76cd31384bb0fdca775fff6_icgraph.svg" width="763" height="103"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a88ef513cfa324fc8548e4fb46d7a67e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88ef513cfa324fc8548e4fb46d7a67e5">&#9670;&nbsp;</a></span>create_weight_matrix_for_blending()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.create_weight_matrix_for_blending </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>img</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>overlaps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>strides</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>create a matrix that is used to normalize the intersection of the stiched patches </p>
<h2>Parameters </h2>
<p>img original image, ndarray</p>
<p>shapes, overlaps, strides: tuples shapes, overlaps and strides of the patches</p>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>weight_mat normalizing weight matrix </dd></dl>

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01401">1401</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a88ef513cfa324fc8548e4fb46d7a67e5_cgraph.svg" width="1382" height="255"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a88ef513cfa324fc8548e4fb46d7a67e5_icgraph.svg" width="547" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="add17b575eb5d81897f4653cab5f2c8e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add17b575eb5d81897f4653cab5f2c8e5">&#9670;&nbsp;</a></span>iqr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.iqr </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>a</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01383">1383</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>

</div>
</div>
<a id="a29956f4cd15f5c59388862472d370986"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29956f4cd15f5c59388862472d370986">&#9670;&nbsp;</a></span>motion_correct_batch_pwrigid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.motion_correct_batch_pwrigid </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_shifts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>strides</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>overlaps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>add_to_movie</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>newoverlaps</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>newstrides</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dview</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>upsample_factor_grid</em> = <code>4</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_deviation_rigid</em> = <code>3</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>splits</em> = <code>56</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>num_splits_to_process</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>num_iter</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>template</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shifts_opencv</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>save_movie</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>nonneg_movie</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function that perform memory efficient hyper parallelized rigid motion corrections while also saving a memory mappable file. </p>
<h2>Parameters </h2>
<p>fname str name of the movie to motion correct. It should not contain nans. All the loadable formats from <a class="el" href="namespace_ca_im_an.html" title="compare how the elements behave ">CaImAn</a> are acceptable</p>
<p>strides tuple strides of patches along x and y</p>
<p>overlaps: overlaps of patches along x and y. exmaple. If strides = (64,64) and overlaps (32,32) patches will be (96,96)</p>
<p>newstrides tuple overlaps after upsampling</p>
<p>newoverlaps tuple strides after upsampling</p>
<p>max_shifts tuple x and y maximum allowd shifts</p>
<p>dview ipyparallel view used to perform parallel computing</p>
<p>splits int number of batches in which the movies is subdivided</p>
<p>num_splits_to_process int number of batches to process. when not <a class="el" href="namespace_none.html" title="pipeline for showing the GUI function in CaImAn ">None</a>, the movie is not saved since only a random subset of batches will be processed</p>
<p>num_iter int number of iterations to perform. The more iteration the better will be the template.</p>
<p>template ndarray if a good approximation of the template to register is available, it can be used</p>
<p>shifts_opencv boolean toggle the shifts applied with opencv, if yes faster but induces some smoothing</p>
<p>save_movie_rigid boolean toggle save movie</p>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>fname_tot_rig str</dd></dl>
<p>total_template:ndarray</p>
<p>templates:list list of produced templates, one per batch</p>
<dl class="section return"><dt>Returns</dt><dd>shifts list inferred rigid shifts to corrrect the movie</dd></dl>
<h2>Raise </h2>
<p>Exception('You need to initialize the template with a good estimate. See the motion' '_correct_batch_rigid function') </p>

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01855">1855</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a29956f4cd15f5c59388862472d370986_cgraph.svg" width="406" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-15" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a29956f4cd15f5c59388862472d370986_icgraph.svg" width="1163" height="103"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aa13476234008dda16f62dc69804dab54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa13476234008dda16f62dc69804dab54">&#9670;&nbsp;</a></span>motion_correct_batch_rigid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.motion_correct_batch_rigid </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_shifts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dview</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>splits</em> = <code>56</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>num_splits_to_process</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>num_iter</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>template</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shifts_opencv</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>save_movie_rigid</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>add_to_movie</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>nonneg_movie</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function that perform memory efficient hyper parallelized rigid motion corrections while also saving a memory mappable file. </p>
<h2>Parameters </h2>
<p>fname str name of the movie to motion correct. It should not contain nans. All the loadable formats from <a class="el" href="namespace_ca_im_an.html" title="compare how the elements behave ">CaImAn</a> are acceptable</p>
<p>max_shifts tuple x and y maximum allowd shifts</p>
<p>dview ipyparallel view used to perform parallel computing</p>
<p>splits int number of batches in which the movies is subdivided</p>
<p>num_splits_to_process int number of batches to process. when not <a class="el" href="namespace_none.html" title="pipeline for showing the GUI function in CaImAn ">None</a>, the movie is not saved since only a random subset of batches will be processed</p>
<p>num_iter int number of iterations to perform. The more iteration the better will be the template.</p>
<p>template ndarray if a good approximation of the template to register is available, it can be used</p>
<p>shifts_opencv boolean toggle the shifts applied with opencv, if yes faster but induces some smoothing</p>
<p>save_movie_rigid boolean toggle save movie</p>
<h2></h2>
<dl class="section return"><dt>Returns</dt><dd>fname_tot_rig str</dd></dl>
<p>total_template:ndarray</p>
<p>templates:list list of produced templates, one per batch</p>
<dl class="section return"><dt>Returns</dt><dd>shifts list inferred rigid shifts to corrrect the movie</dd></dl>
<h2>Raise </h2>
<p>Exception('The movie contains nans. Nans are not allowed!') </p>

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01742">1742</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-16" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_aa13476234008dda16f62dc69804dab54_cgraph.svg" width="606" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-17" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-17-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_aa13476234008dda16f62dc69804dab54_icgraph.svg" width="963" height="103"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="acc77134c68d447075e79102eca9649e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc77134c68d447075e79102eca9649e1">&#9670;&nbsp;</a></span>motion_correct_iteration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.motion_correct_iteration </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>img</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>template</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>frame_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_shift_w</em> = <code>25</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_shift_h</em> = <code>25</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>bilateral_blur</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>diameter</em> = <code>10</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>sigmaColor</em> = <code>10000</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>sigmaSpace</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l00501">501</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-18" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-18-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-18-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-18-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_acc77134c68d447075e79102eca9649e1_icgraph.svg" width="888" height="116"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a178e8317ba3a15bd5e072132ce6fa9f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a178e8317ba3a15bd5e072132ce6fa9f3">&#9670;&nbsp;</a></span>motion_correct_online()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.motion_correct_online </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>movie_iterable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>add_to_movie</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_shift_w</em> = <code>25</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_shift_h</em> = <code>25</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>save_base_name</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>order</em> = <code>'C'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>init_frames_template</em> = <code>100</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>show_movie</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>bilateral_blur</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>template</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>min_count</em> = <code>1000</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>border_to_0</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>n_iter</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>remove_blanks</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>show_template</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>return_mov</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>use_median_as_template</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l00351">351</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-19" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-19-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-19-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-19-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a178e8317ba3a15bd5e072132ce6fa9f3_cgraph.svg" width="379" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-20" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-20-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-20-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-20-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a178e8317ba3a15bd5e072132ce6fa9f3_icgraph.svg" width="675" height="116"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aef9c5f795aeb47c5b86066492953fc4f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef9c5f795aeb47c5b86066492953fc4f">&#9670;&nbsp;</a></span>motion_correct_online_multifile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.motion_correct_online_multifile </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>list_files</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>add_to_movie</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>order</em> = <code>'C'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>kwargs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l00319">319</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-21" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-21-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-21-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-21-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_aef9c5f795aeb47c5b86066492953fc4f_cgraph.svg" width="582" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a7d2c5818773d564a27f831175498ee9a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d2c5818773d564a27f831175498ee9a">&#9670;&nbsp;</a></span>motion_correct_parallel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.motion_correct_parallel </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>file_names</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fr</em> = <code>10</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>template</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>margins_out</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_shift_w</em> = <code>5</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_shift_h</em> = <code>5</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>remove_blanks</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>apply_smooth</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dview</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>save_hdf5</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>motion correct many movies usingthe ipyparallel cluster </p>
<h2>Parameters </h2>
<p>file_names list of strings names of he files to be motion corrected</p>
<p>fr double fr parameters for calcblitz movie</p>
<p>margins_out int number of pixels to remove from the borders</p>
<h2></h2>
<p>base file names of the motion corrected files</p>
<h2>Raise </h2>
<p>Empty Exception </p>

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l00877">877</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-22" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-22-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-22-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-22-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a7d2c5818773d564a27f831175498ee9a_cgraph.svg" width="336" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-23" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-23-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-23-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-23-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a7d2c5818773d564a27f831175498ee9a_icgraph.svg" width="382" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a0609d5c64bb9cae41d945bbc89535d2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0609d5c64bb9cae41d945bbc89535d2a">&#9670;&nbsp;</a></span>motion_correction_piecewise()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.motion_correction_piecewise </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>splits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>strides</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>overlaps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>add_to_movie</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>template</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_shifts</em> = <code>(12,12)</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_deviation_rigid</em> = <code>3</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>newoverlaps</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>newstrides</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>upsample_factor_grid</em> = <code>4</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>order</em> = <code>'F'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>dview</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>save_movie</em> = <code>True</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>base_name</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>num_splits</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shifts_opencv</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>nonneg_movie</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01965">1965</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-24" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-24-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-24-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-24-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a0609d5c64bb9cae41d945bbc89535d2a_icgraph.svg" width="1406" height="103"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ac516b7c059d60b6dd4ba80de17f659bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac516b7c059d60b6dd4ba80de17f659bb">&#9670;&nbsp;</a></span>process_movie_parallel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.process_movie_parallel </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>arg_in</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>buffer_mean=np.zeros((bin_size,)+tf[0].shape).astype() template=np.mean(means_partials[:count_part],0)[ms_h:h_i-ms_h,ms_w:w_i-ms_w] if multicolor: buffer_mean[countbin_size]=page.asarray()[:,:,0]-to_remove else: buffer_mean[countbin_size]=page.asarray()-to_remove </p>
<p>res = cv2.matchTemplate(buffer_mean[countbin_size],template,cv2.TM_CCORR_NORMED) top_left = cv2.minMaxLoc(res)[3]</p>
<p>avg_corr=np.mean(res); sh_y,sh_x = top_left bottom_right = (top_left[0] + w, top_left[1] + h)</p>
<p>if (0 &lt; top_left[1] &lt; 2 * ms_h-1) &amp; (0 &lt; top_left[0] &lt; 2 * ms_w-1): </p>
<h1><a class="anchor" id="autotoc_md4"></a>
if max is internal, check for subpixel shift using gaussian</h1>
<h1><a class="anchor" id="autotoc_md5"></a>
peak registration</h1>
<p>log_xm1_y = np.log(res[sh_x-1,sh_y]); log_xp1_y = np.log(res[sh_x+1,sh_y]); log_x_ym1 = np.log(res[sh_x,sh_y-1]); log_x_yp1 = np.log(res[sh_x,sh_y+1]); four_log_xy = 4*np.log(res[sh_x,sh_y]);</p>
<p>sh_x_n = -(sh_x - ms_h + (log_xm1_y - log_xp1_y) / (2 * log_xm1_y - four_log_xy + 2 * log_xp1_y)) sh_y_n = -(sh_y - ms_w + (log_x_ym1 - log_x_yp1) / (2 * log_x_ym1 - four_log_xy + 2 * log_x_yp1)) else: sh_x_n = -(sh_x - ms_h) sh_y_n = -(sh_y - ms_w)</p>
<p>M = np.float32([[1,0,sh_y_n],[0,1,sh_x_n]]) buffer_mean[countbin_size]= cv2.warpAffine(buffer_mean[countbin_size],M,(w_i,h_i),flags=cv2.INTER_LINEAR) if show_movie: cv2.imshow('frame',(buffer_mean[countbin_size])*1./300) cv2.waitKey(int(1./100*1000)) shifts.append([sh_x_n,sh_y_n]) xcorrs.append([avg_corr]) print count</p>
<p>mean_online=mean_online*count*1./(count + 1) + 1./(count + 1)*buffer_mean[count]</p>
<p>count+=1 linear b-splines knots = np.linspace(1,np.shape(T)[0],Nbasis+1); knots = np.hstack([knots[0]-(knots[1]-knots[0]),knots,knots[-1]+(knots[-1]-knots[-2])]);</p>
<p>weights=knots[:-2] order=len(knots)-len(weights)-1</p>
<p>x=range(T.shape[0])</p>
<p>B = np.zeros((len(x),len(weights))) for ii in range(len(knots)-order-1): B[:,ii] = bin(this.knots,ii,this.order,x); end</p>
<p>spl = fastBSpline(knots,knots(1:end-2))</p>
<p>B = spl.getBasis((1:size(T,1))'); Tnorm = T(:)-mean(T(:)); Tnorm = Tnorm/sqrt(sum(Tnorm.^2)); B = full(B);</p>
<p>lambda = .0001*median(T(:))^2; theI = (eye(Nbasis+1)*lambda);</p>
<p>Bi = B(:,1:end-1).*B(:,2:end); allBs = [B.^2,Bi]; [xi,yi] = meshgrid(1:size(T,2),1:size(T,1)); Displaced template Dx = repmat((B*dpx), 1, w); Dy = repmat((B*dpy), 1, w);</p>
<p>Id = interp2(I, xi, yi, 'linear', 0);</p>
<p>gradient [dTx, dTy] = imgradientxy(Id, 'centraldifference'); dTx(:, [1, ]) = 0; dTy([1, ], :) = 0;</p>
<p>if ii &gt; minIters c = mycorr(Id(:), Tnorm); if c - c0 &lt; deltacorr &amp;&amp; ii &gt; 1 break;</p>
<p>c0 = c;</p>
<pre class="fragment">    del = T - Id;

    %special trick for g (easy)
    gx = B'*sum(del.*dTx, 2);
    gy = B'*sum(del.*dTy, 2);

    %special trick for H - harder
    Hx = constructH(allBs'*sum(dTx.^2,2), nBasis+1) + theI;
    Hy = constructH(allBs'*sum(dTy.^2,2), nBasis+1) + theI;

    dpx = Hx\gx;
    dpy = Hy\gy;

return [Id, dpx, dpy]

     dpx = dpx + damping*dpx_;
     dpy = dpy + damping*dpy_;
</pre><p>function thec = mycorr(A,B) meanA = mean(A(:)); A = A(:) - meanA; A = A / sqrt(sum(A.^2)); thec = A'*B;</p>
<p>function H2 = constructH(Hd,ns) % H2d1 = Hd(1:ns)'; % H2d2 = [Hd(ns+1:);0]'; % H2d3 = [0;Hd(ns+1:)]'; % % if isa(Hd, 'gpuArray') % H2 = gpuArray.zeros(ns); % else % H2 = zeros(ns); % % % H2((0:ns-1)*ns+(1:ns)) = H2d1; % H2(((1:ns-1)*ns+(1:ns-1))) = H2d2(1:-1); % H2(((0:ns-2)*ns+(1:ns-1))+1) = H2d3(2:); </p><pre class="fragment">if isa(Hd, 'gpuArray')
    H2 = gpuArray.zeros(ns);
else
    H2 = zeros(ns);


H2((0:ns-1)*ns+(1:ns)) = Hd(1:ns)';
H2(((1:ns-1)*ns+(1:ns-1))) = Hd(ns+1:)';
H2(((0:ns-2)*ns+(1:ns-1))+1) = Hd(ns+1:)';
</pre><p> %% </p>

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l00795">795</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-25" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-25-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-25-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-25-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_ac516b7c059d60b6dd4ba80de17f659bb_cgraph.svg" width="547" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a0700d66a3a6b2556b1c712daf9c18a9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0700d66a3a6b2556b1c712daf9c18a9b">&#9670;&nbsp;</a></span>register_translation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.register_translation </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>src_image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>target_image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>upsample_factor</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>space</em> = <code>&quot;real&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shifts_lb</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shifts_ub</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_shifts</em> = <code>(10,10)</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01147">1147</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-26" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-26-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-26-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-26-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a0700d66a3a6b2556b1c712daf9c18a9b_cgraph.svg" width="339" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-27" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-27-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-27-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-27-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a0700d66a3a6b2556b1c712daf9c18a9b_icgraph.svg" width="534" height="147"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aef362667b31a29dfcc1a0c35c87f01ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef362667b31a29dfcc1a0c35c87f01ad">&#9670;&nbsp;</a></span>sliding_window()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.sliding_window </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>overlaps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>strides</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>efficiently and lazily slides a window across the image </p>
<h2>Parameters </h2>
<p>img:ndarray 2D image that needs to be slices</p>
<p>windowSize tuple dimension of the patch</p>
<p>strides tuple stride in wach dimension</p>
<h2></h2>
<p>iterator containing five items</p>
<p>dim_1, dim_2 coordinates in the patch grid</p>
<p>x, y: bottom border of the patch in the original matrix</p>
<dl class="section return"><dt>Returns</dt><dd>patch the patch </dd></dl>

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01371">1371</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-28" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-28-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-28-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-28-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_aef362667b31a29dfcc1a0c35c87f01ad_icgraph.svg" width="707" height="74"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="aea060208c09f0e4fb01e6d31b9acf36f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea060208c09f0e4fb01e6d31b9acf36f">&#9670;&nbsp;</a></span>tile_and_correct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.tile_and_correct </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>img</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>template</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>strides</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>overlaps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_shifts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>newoverlaps</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>newstrides</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>upsample_factor_grid</em> = <code>4</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>upsample_factor_fft</em> = <code>10</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>show_movie</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_deviation_rigid</em> = <code>2</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>add_to_movie</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>shifts_opencv</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>perform piecewise rigid motion correction iteration, by 1) dividing the FOV in patches 2) motion correcting each patch separately 3) upsampling the motion correction vector field 4) stiching back together the corrected subpatches </p>
<h2>Parameters </h2>
<p>img ndaarray 2D image to correct</p>
<p>template ndarray reference image</p>
<p>strides tuple strides of the patches in which the FOV is subdivided</p>
<p>overlaps tuple amount of pixel overlaping between patches along each dimension</p>
<p>max_shifts tuple max shifts in x and y</p>
<p>newstrides:tuple strides between patches along each dimension when upsampling the vector fields</p>
<p>newoverlaps:tuple amount of pixel overlaping between patches along each dimension when upsampling the vector fields</p>
<p>upsample_factor_grid int if newshapes or newstrides are not specified this is inferred upsampling by a constant factor the cvector field</p>
<p>upsample_factor_fft int resolution of fractional shifts</p>
<p>show_movie boolean whether to visualize the original and corrected frame during motion correction</p>
<p>max_deviation_rigid int maximum deviation in shifts of each patch from the rigid shift (should not be large)</p>
<p>add_to_movie if movie is too negative the correction might have some issues. In this case it is good to add values so that it is non negative most of the times </p>

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01470">1470</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-29" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-29-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-29-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-29-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_aea060208c09f0e4fb01e6d31b9acf36f_cgraph.svg" width="1187" height="346"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-30" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-30-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-30-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-30-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_aea060208c09f0e4fb01e6d31b9acf36f_icgraph.svg" width="350" height="103"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a9c4d6e518f42c395cb58a08d2ff21f45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c4d6e518f42c395cb58a08d2ff21f45">&#9670;&nbsp;</a></span>tile_and_correct_wrapper()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def caiman.motion_correction.tile_and_correct_wrapper </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>params</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l01903">1903</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>
<div id="dynsection-31" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-31-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-31-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-31-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacecaiman_1_1motion__correction_a9c4d6e518f42c395cb58a08d2ff21f45_cgraph.svg" width="1408" height="384"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab04c428554c372b6f5a453c673f56cc8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab04c428554c372b6f5a453c673f56cc8">&#9670;&nbsp;</a></span>opencv</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool opencv = True</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="motion__correction_8py_source.html#l00068">68</a> of file <a class="el" href="motion__correction_8py_source.html">motion_correction.py</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="footer" role="contentinfo">
&copy; Copyright 2015, Eftychios Pnevmatikakis and Andrea Giovannucci.Created using 
<a href="http://www.stack.nl/~dimitri/doxygen/">Doxygen</a> </div>